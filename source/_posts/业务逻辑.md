---
title: 业务逻辑
date: 2021-01-25 23:26:00
tags: 业务逻辑
---

#### 表单验证通过之后：

```js
if (!err) {
  // 调用api接口
} else {
  message.error("请输入正确的内容");
}
```

#### 某个元素居中对齐

```js
.login-form {
  width:400px;
  position:relative;
  left:50%;
  top:50%;
  tramsform:translate3d(-50%,-50%,0)
}
```

#### 登录逻辑

```js
当用户点击登录之后，肯定是要调服务端接口的，判断是否登录成功，成功则把对应的token存到本地，后面根据token值判断用户是否登录
utils.js
  auth.js
    // 获取token
    export function getToken(){
      return localStorage.getItem('token')
    }
    // 设置token
    export function setToken(token){
      localStorage.setItem('token',token)
    }
    // 退出登录清楚token
    export function clearToken(){
      localStorage.removeItem('token')
    }
    // 判断是否登录
    export function isLogin(){
      if(localStorage.getItem('token')){
        return true
      }
      return false
    }



在所有访问'/admin'的时候，先判断登录与否
isLogin()?<Frame>
            <Switch>{adminRoutes.map(route=>{
              return <Route
              key={route.path}
              path={route.path}
              exact={route.exact}
              render={routeProps=>{
                return <route.component {...routeProps}/>
              }}
            >
            })}
            <Redirect to={adminRoutes[0].path} from='/admin' />
            <Redirect to='/404'>
            </Switch>
          </Frame>:<Redirect to='/login'>

点击登录简单判断
if(!err){
  setToken(values.username)
  props.history.push('/admin') // 登录成功跳转到管理后台首页
}
实操：
if(!err){
  loginApi({
    userName:value.username,
    password:value.password
  }).then(res=>{
    if(res.code === 'success'){
      message.success('登录成功');
      setToken(res.token);
      props.history.push('/admin')
    }else{
      message.info(res.message)
    }
  }).catch(err=>{
    message.error('用户不存在')
  })
}
```

#### 管理后台头像处理

```js
const popMenu = {
  <Menu onClick={p=>{
    if(p.key==='logOut'){
      clearToken();
      props.history.push('/login')
    }else{
      message.info(p.key)
    }
  }}>
    <Menu.Item key='notice'>通知中心</Menu.Item>
    <Menu.Item key='setting'>设置</Menu.Item>
    <Menu.Item key='logOut'>退出</Menu.Item>
  </Menu>
}

DOM:
<div>
  <Dropdown overlay={popMenu}>
    <Avatar>U</Avatar>
    <span style={{}}>超级管理员</span>
    <Icon type='down'>
  </Dropdown>
</div>
```

#### 管理后台所有接口调用都要传递一个 token 值，在请求头里面

```js
token在用户第一次登录的时候会返回给客户端，验证用户是否有权限访问我们接口数据
```

#### 封装请求

```js
request.js;
// 请求拦截器拦截请求增加请求头
config.headers["authorization"] = "Bearer " + getToken();

export function get(url, params) {
  return axios.get(url, {
    params,
  });
}
export function post(url, data) {
  return axios.post(url, data);
}
export function put(url, data) {
  return axios.put(url, data);
}
export function del(url) {
  return axios.delete(url);
}

service.js;
// 登录接口
export function loginApi(user) {
  return post("/路径", user);
}

// 商品接口
export function listApi(page = 1) {
  return get("/", { page, per: 2 }); // 每页显示两条
}
export function createApi(data) {
  return post("/", data);
}
export function modifyOne(id, data) {
  return put(`/${id}`, data);
}
export function deleteOne(id) {
  return del(`/${id}`);
}
```

#### 表格数据处理

```js
{
  title:'序号',
  key:'_id',// 表格返回的数据的唯一值
  wigth:80,
  align:'center',
  render:(txt,record,index)=>index+1
}

rowKey='_id'

const loadData = page=>{

}

pagination={{
  total,
  defaultPageSize:2 // 默认10条
  onChange:loadData // 点击分页
}}
```
